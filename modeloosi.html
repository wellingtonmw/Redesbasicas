<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Modelo OSI: Uma Viagem pelas 7 Camadas da Rede</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
        .card {
            background-color: #1f2937;
            border-radius: 0.75rem;
            border: 1px solid #374151;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            overflow: hidden;
        }
        .layer-btn {
            transition: all 0.2s ease-in-out;
            border-left: 4px solid transparent;
        }
        .layer-btn:hover {
            background-color: #374151;
            border-left-color: #60a5fa;
        }
        .layer-btn.active {
            background-color: #374151;
            border-left-color: #3b82f6;
            color: #fff;
        }
        .data-unit {
            background-color: #374151;
            color: #93c5fd;
            font-family: monospace;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
        .stack-layer {
            padding: 0.75rem;
            border: 1px solid #4b5563;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            background-color: #374151;
            margin: 2px 0;
        }
        .stack-layer.active {
            background-color: #3b82f6;
            color: white;
            transform: scale(1.05);
            border-color: #60a5fa;
        }
        #data-packet .header {
            display: none; /* Hide headers initially */
            padding: 2px 8px;
            margin: 2px 0;
            border-radius: 4px;
            font-weight: bold;
            color: white;
            width: 90%;
            text-align: center;
            font-size: 0.8rem;
        }
        #h7 { background-color: #ef4444; } /* Red */
        #h6 { background-color: #f97316; } /* Orange */
        #h5 { background-color: #eab308; } /* Yellow */
        #h4 { background-color: #84cc16; } /* Lime */
        #h3 { background-color: #22c55e; } /* Green */
        #h2, #t2 { background-color: #14b8a6; } /* Teal */
    </style>
</head>
<body class="bg-gray-900 text-gray-300">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-white">Desvendando o Modelo OSI</h1>
            <p class="mt-4 text-lg max-w-3xl mx-auto">
                Um guia interativo para entender como os dados viajam pela rede, camada por camada.
            </p>
        </header>
        
        <!-- Seção de Introdução -->
        <section class="mb-12">
            <div class="card p-8 text-center">
                 <h2 class="text-3xl font-bold text-white mb-4">O que é o Modelo OSI?</h2>
                 <p class="max-w-4xl mx-auto">
                    Pense no Modelo OSI (Open Systems Interconnection) como as regras dos Correios para enviar uma encomenda. Ele não envia a encomenda, mas define todos os passos necessários: como o pacote deve ser escrito, endereçado, transportado e recebido para garantir que chegue ao destino corretamente. Na rede, ele divide a tarefa complexa de comunicação em 7 camadas menores e mais gerenciáveis.
                 </p>
            </div>
        </section>


        <!-- Seção Interativa das Camadas -->
        <section class="card">
            <div class="grid md:grid-cols-12">
                <!-- Menu Lateral (Navegação) -->
                <nav id="layer-nav" class="md:col-span-4 lg:col-span-3 border-r border-gray-700 p-4">
                    <h3 class="text-xl font-bold text-white mb-4 pl-3">As 7 Camadas</h3>
                    <div class="flex flex-col space-y-1">
                        <button data-layer="7" class="layer-btn text-left p-3 rounded-md font-medium">7. Aplicação</button>
                        <button data-layer="6" class="layer-btn text-left p-3 rounded-md font-medium">6. Apresentação</button>
                        <button data-layer="5" class="layer-btn text-left p-3 rounded-md font-medium">5. Sessão</button>
                        <button data-layer="4" class="layer-btn text-left p-3 rounded-md font-medium">4. Transporte</button>
                        <button data-layer="3" class="layer-btn text-left p-3 rounded-md font-medium">3. Rede</button>
                        <button data-layer="2" class="layer-btn text-left p-3 rounded-md font-medium">2. Enlace</button>
                        <button data-layer="1" class="layer-btn text-left p-3 rounded-md font-medium">1. Física</button>
                    </div>
                </nav>

                <!-- Área de Conteúdo -->
                <main class="md:col-span-8 lg:col-span-9 p-8">
                    <div id="layer-content">
                        <!-- O conteúdo será inserido aqui pelo JavaScript -->
                    </div>
                </main>
            </div>
        </section>
        
        <!-- Seção de Encapsulamento Interativo -->
        <section class="mt-12">
            <div class="card p-8">
                <h2 class="text-3xl font-bold text-white mb-2 text-center">Demonstração de Encapsulamento</h2>
                <p class="text-center text-gray-400 mb-8">Clique em "Próximo Passo" para ver como os dados são encapsulados e desencapsulados.</p>
                
                <div class="grid grid-cols-12 gap-4 items-center min-h-[450px]">
                    <!-- Stack Origem -->
                    <div class="col-span-3 text-center">
                        <h3 class="font-bold text-lg text-white mb-2">Origem</h3>
                        <div id="source-stack" class="flex flex-col justify-between h-full">
                            <!-- Layers will be injected by JS -->
                        </div>
                    </div>
                    
                    <!-- Area de Animação -->
                    <div id="animation-area" class="col-span-6 h-full relative">
                         <div id="data-packet" class="absolute w-4/5 left-1/2" style="transition: all 0.5s ease-in-out; transform: translate(-50%, -50%); top: 50%;">
                            <div class="text-center mb-1"><span id="pdu-name" class="font-bold text-lg text-white"></span></div>
                            <div class="border-2 border-dashed border-gray-600 p-2 rounded-lg bg-gray-800 flex flex-col items-center">
                                <div class="header" id="h7">Cabeçalho de Aplicação (H7)</div>
                                <div class="header" id="h6">Cabeçalho de Apresentação (H6)</div>
                                <div class="header" id="h5">Cabeçalho de Sessão (H5)</div>
                                <div class="header" id="h4">Cabeçalho de Transporte (H4)</div>
                                <div class="header" id="h3">Cabeçalho de Rede (H3)</div>
                                <div class="header" id="h2">Cabeçalho de Enlace (H2)</div>
                                <div id="packet-data" class="bg-blue-500 text-white font-bold p-4 rounded w-full text-center">DADOS</div>
                                <div class="header" id="t2">Trailer de Enlace (T2)</div>
                            </div>
                        </div>
                    </div>

                    <!-- Stack Destino -->
                    <div class="col-span-3 text-center">
                        <h3 class="font-bold text-lg text-white mb-2">Destino</h3>
                        <div id="destination-stack" class="flex flex-col justify-between h-full">
                             <!-- Layers will be injected by JS -->
                        </div>
                    </div>
                </div>

                <div id="explanation-box" class="mt-6 text-center bg-gray-800 p-4 rounded-lg min-h-[60px] flex items-center justify-center">
                    <p id="explanation-text">Clique em "Iniciar" para começar a simulação.</p>
                </div>

                <div class="flex justify-center mt-6 space-x-4">
                    <button id="next-step-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">Iniciar</button>
                    <button id="reset-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">Resetar</button>
                </div>
            </div>
        </section>

    </div>

    <script>
        // --- LÓGICA DA SEÇÃO 1: NAVEGAÇÃO PELAS CAMADAS ---
        const layerData = {
            '7': {
                title: 'Camada 7: Aplicação',
                pdu: 'Dados',
                description: 'É a camada com a qual interagimos diretamente. Ela fornece a interface para os aplicativos de rede, como navegadores, clientes de e-mail e terminais. Ela não é o aplicativo em si, mas o conjunto de serviços que ele usa para se comunicar.',
                analogy: '<strong>Analogia da Carta:</strong> É você escrevendo a carta e o idioma que você usa. O conteúdo que você quer enviar.',
                protocols: 'HTTP, FTP, SMTP, DNS, SSH'
            },
            '6': {
                title: 'Camada 6: Apresentação',
                pdu: 'Dados',
                description: 'Esta camada atua como um "tradutor" para a camada de Aplicação. Ela garante que os dados enviados sejam legíveis pelo sistema receptor. Cuida da formatação, criptografia e compressão dos dados.',
                analogy: '<strong>Analogia da Carta:</strong> É garantir que a carta esteja em um idioma que o destinatário entenda ou usar um código secreto (criptografia) que só vocês dois conhecem.',
                protocols: 'SSL, TLS, JPEG, MPEG'
            },
            '5': {
                title: 'Camada 5: Sessão',
                pdu: 'Dados',
                description: 'Responsável por abrir, gerenciar e encerrar a "conversa" (sessão) entre dois dispositivos. Ela controla o diálogo, decidindo quem fala, quando, por quanto tempo, e como reiniciar uma conversa interrompida.',
                analogy: '<strong>Analogia da Carta:</strong> É o ato de ligar para o destinatário e dizer "Estou te enviando uma carta, ok?". E ele respondendo "Ok, estou esperando". Mantém a comunicação aberta.',
                protocols: 'NetBIOS, PPTP, Sockets'
            },
            '4': {
                title: 'Camada 4: Transporte',
                pdu: 'Segmento / Datagrama',
                description: 'Garante a entrega confiável e ordenada dos dados de ponta a ponta. Ela quebra os dados grandes em pacotes menores (segmentação), controla o fluxo para não sobrecarregar o receptor e pode verificar se todos os pacotes chegaram sem erros.',
                analogy: '<strong>Analogia da Carta:</strong> É como colocar a sua carta (que poderia ter várias páginas) em envelopes numerados (1/3, 2/3, 3/3). Assim, o destinatário pode remontá-la na ordem correta.',
                protocols: 'TCP (confiável), UDP (rápido)'
            },
            '3': {
                title: 'Camada 3: Rede',
                pdu: 'Pacote',
                description: 'Esta é a camada do "endereçamento e roteamento". Ela adiciona os endereços lógicos (como o IP) de origem e destino aos pacotes e determina o melhor caminho que eles devem seguir pela rede (internet) para chegar ao seu destino.',
                analogy: '<strong>Analogia da Carta:</strong> É escrever o CEP, o endereço completo do destinatário e o seu endereço como remetente no envelope. Os Correios (roteadores) usarão isso para encontrar a melhor rota.',
                protocols: 'IP (IPv4, IPv6), ICMP'
            },
            '2': {
                title: 'Camada 2: Enlace (Data Link)',
                pdu: 'Quadro (Frame)',
                description: 'Cuida da comunicação direta entre dois dispositivos na MESMA rede local. Ela adiciona o endereço físico (endereço MAC) da placa de rede de origem e destino. Também é responsável por detectar e, às vezes, corrigir erros que possam ocorrer na camada Física.',
                analogy: '<strong>Analogia da Carta:</strong> É entregar a carta ao carteiro do seu bairro. Ele não sabe o caminho para a cidade de destino, mas sabe exatamente como levar a carta até a agência central dos Correios local.',
                protocols: 'Ethernet, Wi-Fi, PPP'
            },
            '1': {
                title: 'Camada 1: Física',
                pdu: 'Bits',
                description: 'É a camada do hardware. Ela lida com a transmissão e recepção dos bits (zeros e uns) brutos através do meio físico da rede. Isso inclui os cabos, conectores, placas de rede, sinais elétricos, ondas de rádio (Wi-Fi), etc.',
                analogy: '<strong>Analogia da Carta:</strong> É o papel, a tinta, o carro do carteiro e as estradas. É tudo o que é físico e permite que a carta se mova de um lugar para outro.',
                protocols: 'Cabos (Cat5e, Fibra Óptica), Bluetooth'
            }
        };

        const layerNav = document.getElementById('layer-nav');
        const contentArea = document.getElementById('layer-content');
        const buttons = layerNav.querySelectorAll('.layer-btn');

        function updateContent(layerId) {
            const data = layerData[layerId];
            if (!data) return;

            contentArea.innerHTML = `
                <h2 class="text-3xl font-bold text-white mb-2">${data.title}</h2>
                <div class="mb-6">
                    <span class="text-sm text-gray-400">Unidade de Dado:</span>
                    <span class="data-unit">${data.pdu}</span>
                </div>
                <p class="mb-4 text-lg">${data.description}</p>
                <div class="bg-gray-800 p-4 rounded-lg mb-6">
                    <p class="italic">${data.analogy}</p>
                </div>
                <div>
                    <h4 class="font-bold text-white mb-2">Protocolos e Tecnologias Comuns:</h4>
                    <p class="font-mono text-cyan-400">${data.protocols}</p>
                </div>
            `;
            
            buttons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.layer === layerId);
            });
        }

        layerNav.addEventListener('click', (e) => {
            if (e.target.matches('.layer-btn')) {
                const layerId = e.target.dataset.layer;
                updateContent(layerId);
            }
        });
        updateContent('7');

        // --- LÓGICA DA SEÇÃO 2: DEMONSTRAÇÃO DE ENCAPSULAMENTO ---
        const sourceStack = document.getElementById('source-stack');
        const destStack = document.getElementById('destination-stack');
        const dataPacket = document.getElementById('data-packet');
        const pduName = document.getElementById('pdu-name');
        const explanationText = document.getElementById('explanation-text');
        const nextStepBtn = document.getElementById('next-step-btn');
        const resetBtn = document.getElementById('reset-btn');
        const allHeaders = document.querySelectorAll('#data-packet .header');

        const layerNames = {
            '7': 'Aplicação', '6': 'Apresentação', '5': 'Sessão',
            '4': 'Transporte', '3': 'Rede', '2': 'Enlace', '1': 'Física'
        };

        for (let i = 7; i >= 1; i--) {
            sourceStack.innerHTML += `<div id="s-layer-${i}" class="stack-layer"><strong>${i}.</strong> ${layerNames[i]}</div>`;
            destStack.innerHTML += `<div id="d-layer-${i}" class="stack-layer"><strong>${i}.</strong> ${layerNames[i]}</div>`;
        }

        const simulationSteps = [
            { layer: 7, pdu: "Dados", header: "h7", text: "A camada de Aplicação prepara os dados do usuário para transmissão.", side: "source" },
            { layer: 6, pdu: "Dados", header: "h6", text: "A camada de Apresentação formata e criptografa os dados.", side: "source" },
            { layer: 5, pdu: "Dados", header: "h5", text: "A camada de Sessão estabelece e gerencia a conexão.", side: "source" },
            { layer: 4, pdu: "Segmento", header: "h4", text: "A camada de Transporte adiciona informações de porta e controle (TCP/UDP).", side: "source" },
            { layer: 3, pdu: "Pacote", header: "h3", text: "A camada de Rede adiciona os endereços IP de origem e destino.", side: "source" },
            { layer: 2, pdu: "Quadro", header: "h2", trailer: "t2", text: "A camada de Enlace adiciona os endereços MAC e um trailer de verificação.", side: "source" },
            { layer: 1, pdu: "Bits", header: null, text: "A camada Física converte o quadro em sinais para transmissão.", side: "source" },
            { layer: 0, pdu: "Bits", header: null, text: "Os bits são transmitidos através do meio físico (cabos, Wi-Fi...).", side: "transmit" },
            { layer: 1, pdu: "Bits", header: null, text: "A camada Física do destino recebe os sinais e os converte de volta em um quadro.", side: "dest" },
            { layer: 2, pdu: "Quadro", trailer: "t2", header: "h2", text: "A camada de Enlace verifica o endereço MAC e remove seu cabeçalho e trailer.", side: "dest" },
            { layer: 3, pdu: "Pacote", header: "h3", text: "A camada de Rede verifica o endereço IP e remove o cabeçalho IP.", side: "dest" },
            { layer: 4, pdu: "Segmento", header: "h4", text: "A camada de Transporte lê as informações de porta e remove o cabeçalho.", side: "dest" },
            { layer: 5, pdu: "Dados", header: "h5", text: "A camada de Sessão utiliza as informações para gerenciar a conversa.", side: "dest" },
            { layer: 6, pdu: "Dados", header: "h6", text: "A camada de Apresentação descriptografa e formata os dados.", side: "dest" },
            { layer: 7, pdu: "Dados", header: "h7", text: "A camada de Aplicação entrega os dados processados ao software.", side: "dest" },
            { layer: 8, pdu: "Dados", header: null, text: "Simulação completa! Os dados chegaram ao seu destino.", side: "end" }
        ];

        let currentStep = -1;

        function resetSimulation() {
            currentStep = -1;
            allHeaders.forEach(h => h.style.display = 'none');
            document.querySelectorAll('.stack-layer.active').forEach(el => el.classList.remove('active'));
            pduName.textContent = "";
            explanationText.textContent = 'Clique em "Iniciar" para começar a simulação.';
            nextStepBtn.textContent = "Iniciar";
            dataPacket.style.opacity = '1';
            dataPacket.style.top = '50%';
        }

        function runStep() {
            currentStep++;
            const step = simulationSteps[currentStep];

            if (!step) {
                resetSimulation();
                return;
            }
            
            if (currentStep === 0) {
                nextStepBtn.textContent = "Próximo Passo";
            }
            
            if (step.side === "end") {
                nextStepBtn.textContent = "Reiniciar";
            }

            pduName.textContent = step.pdu;
            explanationText.textContent = step.text;

            document.querySelectorAll('.stack-layer.active').forEach(el => el.classList.remove('active'));

            if (step.side === 'source' || step.side === 'dest') {
                const sidePrefix = step.side === 'source' ? 's' : 'd';
                const layerElement = document.getElementById(`${sidePrefix}-layer-${step.layer}`);
                if (layerElement) {
                    layerElement.classList.add('active');
                    
                    // --- INÍCIO DA CORREÇÃO ---
                    // O método anterior com offsetTop não era confiável.
                    // Usar getBoundingClientRect calcula a posição relativa à janela, tornando o alinhamento preciso.
                    const animationArea = document.getElementById('animation-area');
                    const animRect = animationArea.getBoundingClientRect();
                    const layerRect = layerElement.getBoundingClientRect();
                    
                    // Calcula o centro vertical da camada ativa em relação ao topo da janela
                    const layerCenterY_viewport = layerRect.top + (layerRect.height / 2);
                    
                    // Pega a posição do topo da área de animação em relação ao topo da janela
                    const animAreaTop_viewport = animRect.top;
                    
                    // A posição 'top' correta para o pacote é a diferença entre as duas medidas.
                    const topPosition = layerCenterY_viewport - animAreaTop_viewport;
                    
                    dataPacket.style.top = `${topPosition}px`;
                    // --- FIM DA CORREÇÃO ---
                }
            } else if (step.side === 'transmit') {
                dataPacket.style.opacity = '0.5';
            } else if (step.side === 'end') {
                dataPacket.style.opacity = '1';
            }

            if (step.side === 'source') {
                if (step.header) document.getElementById(step.header).style.display = 'block';
                if (step.trailer) document.getElementById(step.trailer).style.display = 'block';
            } else if (step.side === 'dest') {
                 if (step.header) document.getElementById(step.header).style.display = 'none';
                 if (step.trailer) document.getElementById(step.trailer).style.display = 'none';
            }
        }

        nextStepBtn.addEventListener('click', runStep);
        resetBtn.addEventListener('click', resetSimulation);
        
        resetSimulation();
    </script>

</body>
</html>